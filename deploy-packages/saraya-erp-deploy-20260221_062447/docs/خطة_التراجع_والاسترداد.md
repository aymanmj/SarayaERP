# ุฎุทุฉ ุงูุชุฑุงุฌุน ูุงูุงุณุชุฑุฏุงุฏ - ุณุฑุงูุง ERP
## Rollback & Disaster Recovery Procedures

---

## ุงููุญุชููุงุช

1. [ููุฏูุฉ](#ููุฏูุฉ)
2. [ูุณุชููุงุช ุงูุชุฑุงุฌุน](#ูุณุชููุงุช-ุงูุชุฑุงุฌุน)
3. [ุฅุฌุฑุงุกุงุช ุงูุชุฑุงุฌุน](#ุฅุฌุฑุงุกุงุช-ุงูุชุฑุงุฌุน)
4. [ุงุณุชุฑุฏุงุฏ ุงูููุงุฑุซ](#ุงุณุชุฑุฏุงุฏ-ุงูููุงุฑุซ)
5. [ููุงุฆู ุงููุญุต](#ููุงุฆู-ุงููุญุต)
6. [ุฌูุงุช ุงูุงุชุตุงู](#ุฌูุงุช-ุงูุงุชุตุงู)

---

## ููุฏูุฉ

ูุฐุง ุงูุฏููู ููุถุญ ุงูุฅุฌุฑุงุกุงุช ุงููุชุจุนุฉ ูู ุญุงูุฉ:
- ูุดู ุชุญุฏูุซ ุงููุธุงู
- ุญุฏูุซ ุฎูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงููุทุงุน ุงูุฎุฏูุฉ
- ููุฏุงู ุงูุจูุงูุงุช

> โ๏ธ **ููู**: ุงุชุจุน ูุฐู ุงูุฅุฌุฑุงุกุงุช ุจุงูุชุฑุชูุจ ููุง ุชุชุฎุท ุฃู ุฎุทูุฉ

---

## ูุณุชููุงุช ุงูุชุฑุงุฌุน

### ุงููุณุชูู 1: ุชุฑุงุฌุน ุจุณูุท (< 5 ุฏูุงุฆู)

**ูุชู ููุณุชุฎุฏู:**
- ูุดููุฉ ูู ุงููุงุฌูุฉ ููุท
- ุฎุทุฃ ุจุณูุท ุจุนุฏ ุงูุชุญุฏูุซ

**ุงูุฅุฌุฑุงุก:**
1. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุฉ ุงููุชุฃุซุฑุฉ
2. ูุณุญ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช

---

### ุงููุณุชูู 2: ุชุฑุงุฌุน ูุชูุณุท (< 30 ุฏูููุฉ)

**ูุชู ููุณุชุฎุฏู:**
- ูุดู ุชุญุฏูุซ ุงูููุฏ
- ุฎุทุฃ ูู ุงูุฅุนุฏุงุฏุงุช

**ุงูุฅุฌุฑุงุก:**
1. ุงุณุชุนุงุฏุฉ ุงูุฅุตุฏุงุฑ ุงูุณุงุจู ูู ุงูููุฏ
2. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุงุช

---

### ุงููุณุชูู 3: ุชุฑุงุฌุน ูุงูู (< 2 ุณุงุนุฉ)

**ูุชู ููุณุชุฎุฏู:**
- ุชูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุดู ุชุญุฏูุซ Schema

**ุงูุฅุฌุฑุงุก:**
1. ุฅููุงู ุฌููุน ุงูุฎุฏูุงุช
2. ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
3. ุงุณุชุนุงุฏุฉ ุงูููุฏ ุงูุณุงุจู
4. ุฅุนุงุฏุฉ ุงูุชุดุบูู

---

### ุงููุณุชูู 4: ุงุณุชุฑุฏุงุฏ ูุงุฑุซุฉ (< 8 ุณุงุนุงุช)

**ูุชู ููุณุชุฎุฏู:**
- ูุดู ุงูุฎุงุฏู ุจุงููุงูู
- ููุฏุงู ุงูุจูุงูุงุช
- ูุฌูู ุฅููุชุฑููู

**ุงูุฅุฌุฑุงุก:**
1. ุชูุนูู ุงูุฎุงุฏู ุงูุงุญุชูุงุทู
2. ุงุณุชุนุงุฏุฉ ูู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงูุจุนูุฏุฉ
3. ุงูุชุญูู ูู ุณูุงูุฉ ุงูุจูุงูุงุช

---

## ุฅุฌุฑุงุกุงุช ุงูุชุฑุงุฌุน

### ุชุฑุงุฌุน ุงูููุฏ (Git)

```batch
REM ุงูุงูุชูุงู ููุฌูุฏ ุงููุดุฑูุน
cd E:\SarayaERP

REM ุนุฑุถ ุขุฎุฑ 5 ุชุญุฏูุซุงุช
git log --oneline -5

REM ุงูุชุฑุงุฌุน ูุชุญุฏูุซ ูุนูู
git checkout [commit-hash]

REM ุฃู ุงูุชุฑุงุฌุน ููุชุญุฏูุซ ุงูุณุงุจู
git checkout HEAD~1

REM ุฅุนุงุฏุฉ ุงูุจูุงุก
cd server
npm run build

REM ุฅุนุงุฏุฉ ุงูุชุดุบูู
npm run start:prod
```

### ุชุฑุงุฌุน ูุงุนุฏุฉ ุงูุจูุงูุงุช (Prisma)

```batch
REM ุนุฑุถ ุขุฎุฑ ุงูุชุญุฏูุซุงุช
npx prisma migrate status

REM ุงูุชุฑุงุฌุน ุนู ุขุฎุฑ ุชุญุฏูุซ
npx prisma migrate resolve --rolled-back [migration-name]

REM ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุนููู
npx prisma generate
```

### ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุจูุงูุงุช ูุงููุฉ

```batch
REM 1. ุฅููุงู ุงูุฎุฏูุงุช
net stop saraya-backend

REM 2. ุฅูุดุงุก ูุณุฎุฉ ูู ุงูุญุงูุฉ ุงูุญุงููุฉ (ููุงุญุชูุงุท)
set PGPASSWORD=your_password
pg_dump -h localhost -U postgres -d saraya > emergency_backup.sql

REM 3. ุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ
psql -h localhost -U postgres -c "DROP DATABASE saraya;"

REM 4. ุฅูุดุงุก ูุงุนุฏุฉ ุฌุฏูุฏุฉ
psql -h localhost -U postgres -c "CREATE DATABASE saraya;"

REM 5. ุงุณุชุนุงุฏุฉ ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
psql -h localhost -U postgres -d saraya -f C:\backups\saraya\daily\saraya_daily_YYYYMMDD.sql

REM 6. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุงุช
net start saraya-backend
```

---

## ุงุณุชุฑุฏุงุฏ ุงูููุงุฑุซ

### ุงูุณููุงุฑูู 1: ูุดู ุงูุฎุงุฏู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         ุฎุทูุงุช ุงูุงุณุชุฑุฏุงุฏ                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 1. ุชุฃูุฏ ูู ูุดู ุงูุฎุงุฏู ุงูุฑุฆูุณู          โ
โ 2. ูุนูู ุฎุงุฏู ุงูุทูุงุฑุฆ                    โ
โ 3. ูุฌูู DNS ููุฎุงุฏู ุงูุฌุฏูุฏ               โ
โ 4. ุงุณุชุนุฏ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ              โ
โ 5. ุชุญูู ูู ุนูู ุงููุธุงู                  โ
โ 6. ุฃุฎุทุฑ ุงููุณุชุฎุฏููู                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุงูุณููุงุฑูู 2: ุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

1. **ุชูููู ุงูุถุฑุฑ**
```sql
-- ูุญุต ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
SELECT tablename FROM pg_tables WHERE schemaname = 'public';

-- ูุญุต ุณูุงูุฉ ุงูุฌุฏุงูู
VACUUM ANALYZE;
```

2. **ุงุณุชุนุงุฏุฉ ูู ุขุฎุฑ ูุณุฎุฉ ุณูููุฉ**
```batch
REM ุงูุจุญุซ ุนู ุขุฎุฑ ูุณุฎุฉ ุณูููุฉ
dir C:\backups\saraya\daily\*.sql /od

REM ุงุณุชุนุงุฏุฉ
psql -h localhost -U postgres -d saraya -f [latest_backup.sql]
```

3. **ุงูุชุญูู**
```sql
-- ุนุฏ ุงูุณุฌูุงุช ูู ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ
SELECT 
  (SELECT COUNT(*) FROM "Patient") as patients,
  (SELECT COUNT(*) FROM "Encounter") as encounters,
  (SELECT COUNT(*) FROM "Invoice") as invoices;
```

### ุงูุณููุงุฑูู 3: ูุฌูู ุฑุงูุณููููุฑ

> ๐จ **ุฎุทูุงุช ููุฑูุฉ:**

1. **ุงูุตู ุงูุฎุงุฏู ุนู ุงูุดุจูุฉ ููุฑุงู**
2. **ูุง ุชุฏูุน ุงููุฏูุฉ**
3. **ุงุชุตู ุจูุฑูู ุงูุฃูุงู**
4. **ูุซูู ูู ุดูุก**

**ุฅุฌุฑุงุกุงุช ุงูุงุณุชุฑุฏุงุฏ:**

```batch
REM 1. ุงุณุชุฎุฏู ุฌูุงุฒ ูุธูู ููุงุณุชุฑุฏุงุฏ
REM 2. ุชุซุจูุช ูุธุงู ุชุดุบูู ุฌุฏูุฏ
REM 3. ุงุณุชุนุงุฏุฉ ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุนุฒููุฉ (offline)

REM ุงุณุชุนุงุฏุฉ ูู ุงููุณุฎุฉ ุงูุดูุฑูุฉ (ุนุงุฏุฉ ุชููู ูุนุฒููุฉ)
psql -h localhost -U postgres -d saraya -f [monthly_backup.sql]
```

---

## ููุงุฆู ุงููุญุต

### ูุจู ุงูุชุญุฏูุซ

- [ ] ุฅุฎุทุงุฑ ุงููุณุชุฎุฏููู ุจููุนุฏ ุงูุตูุงูุฉ (24 ุณุงุนุฉ ููุฏูุงู)
- [ ] ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ
- [ ] ุชูุซูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู: `git rev-parse HEAD`
- [ ] ุงุฎุชุจุงุฑ ุฎุทุฉ ุงูุชุฑุงุฌุน ูู ุจูุฆุฉ ุชุฌุฑูุจูุฉ
- [ ] ุชุฌููุฒ ูุฑูู ุงูุฏุนู

### ุฃุซูุงุก ุงูุชุญุฏูุซ

- [ ] ุฅููุงู ุงููุตูู ูููุณุชุฎุฏููู
- [ ] ุชูููุฐ ุงูุชุญุฏูุซ
- [ ] ุงุฎุชุจุงุฑ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ:
  - [ ] ุชุณุฌูู ุงูุฏุฎูู
  - [ ] ูุชุญ ููู ูุฑูุถ
  - [ ] ุฅูุดุงุก ูุงุชูุฑุฉ
  - [ ] ุตุฑู ูุตูุฉ
- [ ] ูุญุต ุงูุณุฌูุงุช ููุฃุฎุทุงุก

### ุจุนุฏ ุงูุชุญุฏูุซ

- [ ] ุฅุนุงุฏุฉ ุงููุตูู ูููุณุชุฎุฏููู
- [ ] ูุฑุงูุจุฉ ุงููุธุงู ููุฏุฉ ุณุงุนุฉ
- [ ] ุงูุชุฃูุฏ ูู ุนูู ุงููุณุฎ ุงูุงุญุชูุงุทู
- [ ] ุฅุฎุทุงุฑ ุงููุณุชุฎุฏููู ุจุงูุชูุงู ุงูุชุญุฏูุซ

### ุนูุฏ ุญุฏูุซ ูุดููุฉ

- [ ] ุชูููู ุดุฏุฉ ุงููุดููุฉ (ูุณุชูู 1-4)
- [ ] ุฅุฎุทุงุฑ ุงููุฑูู ุงููุนูู
- [ ] ุจุฏุก ุฅุฌุฑุงุกุงุช ุงูุชุฑุงุฌุน ุงูููุงุณุจุฉ
- [ ] ุชูุซูู ุงููุดููุฉ ูุงูุญู
- [ ] ุชุญุฏูุซ ุฎุทุฉ ุงูุชุฑุงุฌุน ุจูุงุกู ุนูู ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

---

## ุฌูุงุช ุงูุงุชุตุงู

### ูุฑูู ุงูุทูุงุฑุฆ

| ุงูุฏูุฑ | ุงูุงุณู | ุงููุงุชู | ุงูุจุฑูุฏ |
|-------|-------|--------|--------|
| ูุณุคูู ุงููุธุงู | [ุงูุงุณู] | [ุงูุฑูู] | admin@saraya-erp.com |
| ูุทูุฑ ุฑุฆูุณู | [ุงูุงุณู] | [ุงูุฑูู] | dev@saraya-erp.com |
| ูุณุคูู ูุงุนุฏุฉ ุงูุจูุงูุงุช | [ุงูุงุณู] | [ุงูุฑูู] | dba@saraya-erp.com |
| ูุณุคูู ุงูุฃูุงู | [ุงูุงุณู] | [ุงูุฑูู] | security@saraya-erp.com |

### ุงูุชุตุนูุฏ

```
ุงููุณุชูู 1: ูุณุคูู ุงููุธุงู (ุฃูู 15 ุฏูููุฉ)
    โ
ุงููุณุชูู 2: ุงููุทูุฑ ุงูุฑุฆูุณู (15-60 ุฏูููุฉ)
    โ
ุงููุณุชูู 3: ูุฏูุฑ ุชูููุฉ ุงููุนูููุงุช (> ุณุงุนุฉ)
    โ
ุงููุณุชูู 4: ุงูุฅุฏุงุฑุฉ ุงูุนููุง (ูุงุฑุซุฉ)
```

---

## ููุงุญู

### ููุญู ุฃ: ููุงูุน ุงููููุงุช ุงููููุฉ

```
E:\SarayaERP\
โโโ server\
โ   โโโ .env                 # ุฅุนุฏุงุฏุงุช ุงูุจูุฆุฉ
โ   โโโ prisma\
โ   โ   โโโ schema.prisma    # ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ   โโโ dist\                # ุงูููุฏ ุงูููุฌููุน
โโโ client\
โ   โโโ dist\                # ุงููุงุฌูุฉ ุงูููุฌููุนุฉ
โโโ docs\                    # ุงูุชูุซูู

C:\backups\saraya\           # ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
```

### ููุญู ุจ: ุฃููุงุช ุงูุงุณุชุฑุฏุงุฏ ุงููุชููุนุฉ

| ุงูุณููุงุฑูู | RTO* | RPO** |
|-----------|------|-------|
| ุฅุนุงุฏุฉ ุชุดุบูู ุจุณูุทุฉ | 5 ุฏูุงุฆู | 0 |
| ุชุฑุงุฌุน ููุฏ | 15 ุฏูููุฉ | 0 |
| ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุจูุงูุงุช | 1 ุณุงุนุฉ | < 24 ุณุงุนุฉ |
| ุงุณุชุฑุฏุงุฏ ูุงุฑุซุฉ | 4 ุณุงุนุงุช | < 24 ุณุงุนุฉ |

*RTO: Recovery Time Objective - ููุช ุงูุงุณุชุนุงุฏุฉ ุงููุณุชูุฏู  
**RPO: Recovery Point Objective - ููุทุฉ ุงูุงุณุชุนุงุฏุฉ ุงููุณุชูุฏูุฉ

---

> ๐ **ุงุฎุชูุจุฑุช ูุฐู ุงูุฎุทุฉ ุขุฎุฑ ูุฑุฉ**: [ุงูุชุงุฑูุฎ]  
> ๐ **ููุนุฏ ุงูุงุฎุชุจุงุฑ ุงููุงุฏู**: [ุงูุชุงุฑูุฎ]  
> โ๏ธ **ุงููุณุคูู ุนู ุงูุชุญุฏูุซ**: [ุงูุงุณู]
