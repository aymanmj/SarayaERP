<html lang='ar' dir='rtl'>
  <head>
    <meta charset='UTF-8' />
    <title>{{#if (eq invoiceType 'CREDIT_NOTE')}}إشعار دائن{{else}}فاتورة{{/if}} #{{invoiceId}}</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
      :root {
        --primary: #0f766e; /* Emerald 700 */
        --primary-light: #f0fdfa; /* Emerald 50 */
        --danger: #be123c; /* Rose 700 */
        --danger-light: #fff1f2;
        --text: #1e293b;
        --gray: #64748b;
        --border: #e2e8f0;
      }

      body {
        font-family: 'Cairo', sans-serif;
        font-size: 11px;
        color: var(--text);
        line-height: 1.4;
        margin: 0;
        padding: 0;
        -webkit-print-color-adjust: exact;
      }

      /* Layout */
      .page-container {
        padding: 30px 40px;
        background: white;
      }

      /* Watermark */
      .watermark {
        position: fixed;
        top: 35%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-30deg);
        font-size: 100px;
        font-weight: 900;
        color: rgba(190, 18, 60, 0.05);
        border: 8px solid rgba(190, 18, 60, 0.05);
        padding: 20px 60px;
        border-radius: 30px;
        z-index: 0;
        pointer-events: none;
      }

      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        border-bottom: 2px solid var(--primary);
        padding-bottom: 20px;
        margin-bottom: 30px;
      }
      .hospital-info h1 {
        color: var(--primary);
        font-size: 24px;
        margin: 0 0 5px 0;
        font-weight: 800;
      }
      .hospital-info p {
        margin: 2px 0;
        font-size: 11px;
        color: var(--gray);
      }
      .doc-type {
        text-align: left;
      }
      .doc-title {
        font-size: 20px;
        font-weight: 800;
        text-transform: uppercase;
        color: var(--text);
      }
      .invoice-id {
        background: var(--text);
        color: white;
        padding: 4px 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 14px;
        font-weight: 700;
        display: inline-block;
        margin-top: 5px;
      }

      /* Credit Note Style Override */
      .credit-note-theme .header { border-bottom-color: var(--danger); }
      .credit-note-theme .doc-title { color: var(--danger); }
      .credit-note-theme .invoice-id { background: var(--danger); }

      /* Info Grid */
      .info-container {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
      }
      .info-box {
        flex: 1;
        background-color: var(--primary-light);
        border: 1px solid #ccfbf1;
        border-radius: 8px;
        padding: 15px;
      }
      .credit-note-theme .info-box {
        background-color: var(--danger-light);
        border-color: #fecdd3;
      }

      .info-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 6px;
        border-bottom: 1px dashed rgba(0,0,0,0.05);
        padding-bottom: 4px;
      }
      .info-row:last-child { border-bottom: none; margin-bottom: 0; }
      .label { color: var(--gray); font-weight: 600; font-size: 10px; }
      .value { font-weight: 700; color: var(--text); }

      /* Table */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 30px;
      }
      th {
        background-color: var(--text);
        color: white;
        padding: 10px;
        text-align: right;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
      }
      .credit-note-theme th { background-color: var(--danger); }
      
      td {
        padding: 10px;
        border-bottom: 1px solid var(--border);
        vertical-align: top;
      }
      tr:nth-child(even) td { background-color: #f8fafc; }
      
      .col-num { width: 40px; text-align: center; color: var(--gray); }
      .col-qty { text-align: center; width: 60px; }
      .col-money { text-align: right; width: 100px; font-family: monospace; font-weight: 600; }
      .col-total { text-align: right; width: 120px; font-weight: 700; font-family: monospace; color: var(--primary); }
      
      /* Footer Section */
      .footer-section {
        display: flex;
        gap: 40px;
      }
      .notes-area {
        flex: 2;
        font-size: 10px;
        color: var(--gray);
        line-height: 1.6;
      }
      .totals-area {
        flex: 1;
        background: #fff;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 15px;
      }
      .total-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 11px;
      }
      .total-row.grand {
        border-top: 2px solid var(--text);
        margin-top: 10px;
        padding-top: 10px;
        font-size: 16px;
        font-weight: 800;
        color: var(--primary);
      }
      .credit-note-theme .total-row.grand { color: var(--danger); border-top-color: var(--danger); }

      /* QR & Signatures */
      .bottom-bar {
        margin-top: 50px;
        border-top: 1px solid var(--border);
        padding-top: 20px;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
      }
      .signature {
        text-align: center;
        width: 150px;
      }
      .signature-line {
        border-bottom: 1px solid var(--gray);
        margin-bottom: 5px;
        height: 40px;
      }
      .signature-title {
        font-size: 10px;
        color: var(--gray);
        font-weight: 700;
      }
      .system-footer {
        text-align: center;
        margin-top: 30px;
        font-size: 9px;
        color: #cbd5e1;
      }
    </style>
  </head>
  <body class="{{#if (eq invoiceType 'CREDIT_NOTE')}}credit-note-theme{{/if}}">

    {{#if (eq invoiceType 'CREDIT_NOTE')}}
      <div class="watermark">مرتجع / RETURN</div>
    {{/if}}

    <div class="page-container">
      
      <!-- Header -->
      {{#if printHeaderFooter}}
      <div class='header'>
        <div class="hospital-info">
          <h1>{{hospitalName}}</h1>
          <p>{{address}}</p>
          <p dir="ltr">{{phone}} | {{email}}</p>
        </div>
        <div class="doc-type">
          {{#if (eq invoiceType 'CREDIT_NOTE')}}
            <div class='doc-title'>إشعار دائن</div>
            <div style="font-size:10px; color:#be123c;">CREDIT NOTE</div>
          {{else}}
            <div class='doc-title'>فاتورة ضريبية</div>
            <div style="font-size:10px; color:#64748b;">TAX INVOICE</div>
          {{/if}}
          <div class='invoice-id'>#{{invoiceId}}</div>
        </div>
      </div>
      {{else}}
      <div style="height: 140px;"></div>
      <div style="text-align:left; margin-bottom:20px;"><div class='invoice-id'>#{{invoiceId}}</div></div>
      {{/if}}

      <!-- Info Boxes -->
      <div class="info-container">
        <div class="info-box">
          <div class="info-row">
            <span class="label">المريض / Patient</span>
            <span class="value">{{patientName}}</span>
          </div>
          <div class="info-row">
            <span class="label">رقم الملف / MRN</span>
            <span class="value" style="font-family:monospace;">{{mrn}}</span>
          </div>
          <div class="info-row">
            <span class="label">الجهة الضامنة</span>
            <span class="value">{{insuranceProvider}}</span>
          </div>
        </div>
        <div class="info-box">
          <div class="info-row">
            <span class="label">تاريخ الإصدار</span>
            <span class="value">{{formatDate invoiceDate}}</span>
          </div>
          <div class="info-row">
            <span class="label">حالة الفاتورة</span>
            <span class="value">{{status}}</span>
          </div>
          {{#if originalInvoiceId}}
          <div class="info-row">
            <span class="label">فاتورة أصلية</span>
            <span class="value">#{{originalInvoiceId}}</span>
          </div>
          {{/if}}
        </div>
      </div>

      <!-- Items Table -->
      <table>
        <thead>
          <tr>
            <th class="col-num">#</th>
            <th>البيان / Description</th>
            <th class="col-qty">الكمية</th>
            <th class="col-money">السعر</th>
            <th class="col-total">الإجمالي</th>
          </tr>
        </thead>
        <tbody>
          {{#each items}}
            <tr>
              <td class="col-num">{{inc @index}}</td>
              <td style="font-weight: 600;">{{serviceName}}</td>
              <td class="col-qty">{{quantity}}</td>
              <td class="col-money">{{formatMoney unitPrice}}</td>
              <td class="col-total">{{formatMoney totalAmount}}</td>
            </tr>
          {{/each}}
        </tbody>
      </table>

      <!-- Footer & Totals -->
      <div class='footer-section'>
        <div class="notes-area">
            <strong>الشروط والأحكام:</strong><br>
            • تعتبر هذه الفاتورة سنداً رسمياً ولا يعتد بأي تعديل يدوي عليها.<br>
            • يرجى الاحتفاظ بالفاتورة للمراجعة أو الإرجاع حسب السياسة.<br>
            • تم الإنشاء إلكترونياً بواسطة نظام Saraya ERP.<br><br>
            
            {{#if qrCode}}
              <img src='{{qrCode}}' style="width:70px; height:70px; border:1px solid #eee; padding:3px;" />
            {{/if}}
        </div>

        <div class='totals-area'>
          <div class='total-row'>
            <span>المجموع الفرعي</span>
            <span style="font-family:monospace;">{{formatMoney subTotal}}</span>
          </div>
          
          {{#if (gt discountAmount 0)}}
          <div class='total-row' style="color: #be123c;">
            <span>الخصم</span>
            <span style="font-family:monospace;">({{formatMoney discountAmount}})</span>
          </div>
          {{/if}}

          {{#if (gt vatAmount 0)}}
          <div class='total-row'>
            <span>الضريبة (VAT)</span>
            <span style="font-family:monospace;">{{formatMoney vatAmount}}</span>
          </div>
          {{/if}}

          <div class="total-row grand">
            <span>الإجمالي</span>
            <span><small>LYD</small> {{formatMoney netAmount}}</span>
          </div>
        </div>
      </div>

      <!-- Signatures -->
      <div class="bottom-bar">
         <div class="signature">
            <div class="signature-line"></div>
            <div class="signature-title">أمين الصندوق / Cashier</div>
         </div>
         <div class="signature">
            <div class="signature-line"></div>
            <div class="signature-title">المستلم / Receiver</div>
         </div>
      </div>

      <div class="system-footer">
         Saraya Hospital Management System &copy; {{year}}
      </div>
    </div>

  </body>
</html>


{{!-- <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>{{#if (eq invoiceType 'CREDIT_NOTE')}}إشعار دائن{{else}}فاتورة ضريبية{{/if}} #{{invoiceId}}</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f766e; /* Emerald 700 */
            --primary-light: #f0fdfa;
            --danger: #be123c; /* Rose 700 */
            --danger-light: #fff1f2;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --border: #e2e8f0;
        }

        body {
            font-family: 'Cairo', sans-serif;
            font-size: 12px;
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            -webkit-print-color-adjust: exact;
        }

        .page-container {
            width: 100%;
            max-width: 210mm; /* A4 width */
            margin: 0 auto;
            padding: 40px;
            box-sizing: border-box;
            background: white;
            position: relative;
        }

        /* Watermark for Credit Note */
        .watermark {
            position: absolute;
            top: 35%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 100px;
            font-weight: 900;
            color: rgba(190, 18, 60, 0.08);
            border: 8px solid rgba(190, 18, 60, 0.08);
            padding: 20px 60px;
            border-radius: 20px;
            z-index: 0;
            pointer-events: none;
            white-space: nowrap;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .hospital-details h1 {
            color: var(--primary);
            font-size: 24px;
            margin: 0 0 5px 0;
        }
        .hospital-details p {
            margin: 2px 0;
            font-size: 11px;
            color: var(--text-gray);
        }

        .invoice-meta {
            text-align: left;
        }
        .doc-title {
            font-size: 22px;
            font-weight: 800;
            text-transform: uppercase;
            color: var(--text-dark);
            letter-spacing: 1px;
        }
        .doc-subtitle {
            font-size: 12px;
            color: var(--text-gray);
            margin-bottom: 8px;
        }
        .invoice-id {
            background: var(--text-dark);
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            display: inline-block;
        }

        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .info-box {
            background: var(--primary-light);
            border: 1px solid #ccfbf1;
            border-radius: 8px;
            padding: 15px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            border-bottom: 1px dashed #e2e8f0;
            padding-bottom: 4px;
        }
        .info-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .info-label {
            font-weight: 600;
            color: var(--text-gray);
            font-size: 11px;
        }
        .info-val {
            font-weight: 700;
            color: var(--text-dark);
        }

        /* Special style for Credit Note Header */
        .is-credit-note .doc-title { color: var(--danger); }
        .is-credit-note .invoice-id { background: var(--danger); }
        .is-credit-note .info-box { background: var(--danger-light); border-color: #fecdd3; }

        /* Items Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            font-size: 12px;
        }
        th {
            background-color: var(--text-dark);
            color: white;
            padding: 12px;
            text-align: right;
            font-weight: 600;
        }
        .is-credit-note th { background-color: var(--danger); }
        
        td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }
        tr:nth-child(even) td { background-color: #f8fafc; }
        
        .col-num { width: 40px; text-align: center; color: var(--text-gray); }
        .col-desc { font-weight: 600; }
        .col-qty { text-align: center; width: 60px; }
        .col-price { text-align: right; width: 100px; font-family: monospace; }
        .col-total { text-align: right; width: 120px; font-weight: 700; font-family: monospace; }

        /* Footer Section */
        .footer-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 40px;
            margin-top: 20px;
        }
        
        .terms-box {
            font-size: 10px;
            color: var(--text-gray);
            line-height: 1.6;
        }
        .qr-box {
            margin-top: 15px;
            width: 80px;
            height: 80px;
            border: 1px solid var(--border);
            padding: 4px;
        }
        .qr-img { width: 100%; height: 100%; }

        .totals-box {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
        }
        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
        }
        .total-row.grand {
            border-top: 2px solid var(--text-dark);
            padding-top: 10px;
            margin-top: 10px;
            font-size: 16px;
            font-weight: 800;
            color: var(--primary);
        }
        .is-credit-note .total-row.grand { color: var(--danger); border-top-color: var(--danger); }

        .signatures {
            margin-top: 60px;
            display: flex;
            justify-content: space-between;
            padding-top: 10px;
            border-top: 1px solid var(--border);
            font-size: 11px;
            color: var(--text-gray);
        }
    </style>
</head>
<body class="{{#if (eq invoiceType 'CREDIT_NOTE')}}is-credit-note{{/if}}">

    {{#if (eq invoiceType 'CREDIT_NOTE')}}
      <div class="watermark">مرتجع / RETURN</div>
    {{/if}}

    <div class="page-container">
        <!-- Header -->
        {{#if printHeaderFooter}}
        <div class="header">
            <div class="hospital-details">
                <h1>{{hospitalName}}</h1>
                <p>{{address}}</p>
                <p style="direction: ltr; text-align: right;">{{phone}} | {{email}}</p>
            </div>
            <div class="invoice-meta">
                {{#if (eq invoiceType 'CREDIT_NOTE')}}
                  <div class="doc-title">إشعار دائن</div>
                  <div class="doc-subtitle">Credit Note</div>
                {{else}}
                  <div class="doc-title">فاتورة ضريبية</div>
                  <div class="doc-subtitle">Tax Invoice</div>
                {{/if}}
                <div class="invoice-id">#{{invoiceId}}</div>
            </div>
        </div>
        {{else}}
        <div style="height: 140px;"></div> <!-- Spacer for pre-printed paper -->
        <div style="text-align: left; margin-bottom: 20px;">
            <div class="invoice-id">#{{invoiceId}}</div>
        </div>
        {{/if}}

        <!-- Info Grid -->
        <div class="info-grid">
            <div class="info-box">
                <div class="info-row">
                    <span class="info-label">المريض / Patient</span>
                    <span class="info-val">{{patientName}}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">رقم الملف / MRN</span>
                    <span class="info-val" style="font-family: monospace;">{{mrn}}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">الجهة الضامنة / Client</span>
                    <span class="info-val">{{insuranceProvider}}</span>
                </div>
            </div>
            <div class="info-box">
                <div class="info-row">
                    <span class="info-label">تاريخ الإصدار / Date</span>
                    <span class="info-val">{{formatDate invoiceDate}}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">حالة الفاتورة / Status</span>
                    <span class="info-val">{{status}}</span>
                </div>
                {{#if originalInvoiceId}}
                <div class="info-row">
                    <span class="info-label">رقم الفاتورة الأصلية</span>
                    <span class="info-val">#{{originalInvoiceId}}</span>
                </div>
                {{/if}}
            </div>
        </div>

        <!-- Items Table -->
        <table>
            <thead>
                <tr>
                    <th class="col-num">#</th>
                    <th>البيان / Description</th>
                    <th class="col-qty">الكمية</th>
                    <th class="col-price">السعر</th>
                    <th class="col-total">الإجمالي</th>
                </tr>
            </thead>
            <tbody>
                {{#each items}}
                <tr>
                    <td class="col-num">{{inc @index}}</td>
                    <td class="col-desc">{{serviceName}}</td>
                    <td class="col-qty">{{quantity}}</td>
                    <td class="col-price">{{formatMoney unitPrice}}</td>
                    <td class="col-total">{{formatMoney totalAmount}}</td>
                </tr>
                {{/each}}
            </tbody>
        </table>

        <!-- Footer Grid -->
        <div class="footer-grid">
            <div class="terms-box">
                <strong>الشروط والأحكام:</strong><br>
                1. تعتبر هذه الفاتورة سند استحقاق رسمي.<br>
                2. في حال وجود خطأ، يرجى المراجعة خلال 3 أيام.<br>
                3. هذه الفاتورة صادرة إلكترونياً من نظام Saraya ERP.<br>
                
                {{#if qrCode}}
                <div class="qr-box">
                    <img src="{{qrCode}}" class="qr-img"/>
                </div>
                {{/if}}
            </div>

            <div class="totals-box">
                <div class="total-row">
                    <span>المجموع الفرعي</span>
                    <span>{{formatMoney subTotal}}</span>
                </div>
                {{#if (gt discountAmount 0)}}
                <div class="total-row" style="color: var(--danger);">
                    <span>الخصم</span>
                    <span>({{formatMoney discountAmount}})</span>
                </div>
                {{/if}}
                {{#if (gt vatAmount 0)}}
                <div class="total-row">
                    <span>الضريبة (VAT)</span>
                    <span>{{formatMoney vatAmount}}</span>
                </div>
                {{/if}}
                <div class="total-row grand">
                    <span>الإجمالي المستحق</span>
                    <span>{{formatMoney netAmount}} <small style="font-size:10px; font-weight:400;">LYD</small></span>
                </div>
            </div>
        </div>

        <div class="signatures">
            <div>المحاسب / Cashier</div>
            <div>المستلم / Receiver</div>
            <div>المدير المالي / Financial Manager</div>
        </div>
        
        <div style="text-align:center; margin-top:20px; font-size:9px; color:#cbd5e1;">
            Powered by Saraya ERP Systems
        </div>
    </div>
</body>
</html>
 --}}



{{!-- <html lang='ar' dir='rtl'>
  <head>
    <meta charset='UTF-8' />
    <title>{{#if (eq invoiceType 'CREDIT_NOTE')}}إشعار دائن{{else}}فاتورة ضريبية{{/if}} #{{invoiceId}}</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Cairo', 'Segoe UI', Tahoma, sans-serif;
        font-size: 10px;
        color: #334155; /* Slate-700 */
        line-height: 1.5;
        margin: 0;
        padding: 0;
      }

      .container {
        width: 100%;
        margin: 0 auto;
      }

      /* Header Styling */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center; /* Center Vertically */
        border-bottom: 2px solid #0f766e; /* Emerald-700 */
        padding-bottom: 25px;
        margin-bottom: 30px;
      }

      .hospital-info h1 {
        color: #0f766e;
        font-size: 22px;
        margin: 0 0 5px 0;
        font-weight: 700;
      }

      .hospital-info p {
        margin: 2px 0;
        font-size: 10px;
        color: #64748b;
      }

      .invoice-info {
        text-align: left;
      }

      .doc-title {
        font-size: 18px;
        font-weight: 700;
        text-transform: uppercase;
        color: #1e293b;
        margin-bottom: 5px;
      }
      
      .doc-title.credit-note {
        color: #be123c; /* Rose-700 */
      }

      .invoice-number-badge {
        background: #f1f5f9;
        padding: 5px 10px;
        border-radius: 4px;
        font-family: 'Courier New', Courier, monospace;
        font-weight: bold;
        font-size: 14px;
        color: #334155;
        border: 1px solid #e2e8f0;
        display: inline-block;
      }

      /* Meta Grid */
      .meta-box {
        display: flex;
        flex-wrap: wrap;
        background-color: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 25px;
      }

      .meta-item {
        width: 25%; /* 4 columns */
        margin-bottom: 5px;
      }

      .meta-label {
        font-size: 9px;
        color: #94a3b8;
        font-weight: 600;
        display: block;
        margin-bottom: 2px;
      }

      .meta-value {
        font-size: 11px;
        font-weight: 700;
        color: #0f172a;
      }

      /* Table */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 30px;
      }

      th {
        background-color: #0f766e;
        color: white;
        padding: 10px;
        text-align: right;
        font-size: 10px;
        font-weight: 600;
      }

      td {
        padding: 10px;
        border-bottom: 1px solid #e2e8f0;
        font-size: 10px;
        vertical-align: middle;
      }

      tr:nth-child(even) {
        background-color: #f8fafc;
      }
      
      .row-num {
        color: #94a3b8;
        font-family: monospace;
      }

      /* Footer Section */
      .footer-section {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-top: 10px;
        page-break-inside: avoid;
      }

      .notes-box {
        width: 55%;
        font-size: 9px;
        color: #64748b;
        padding: 12px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        line-height: 1.6;
      }

      .totals-box {
        width: 35%;
      }

      .total-row {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
        font-size: 11px;
      }

      .total-row.final {
        border-top: 2px solid #0f172a;
        background: #f1f5f9;
        padding: 10px;
        margin-top: 10px;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 800;
        color: #0f766e;
      }
      
      .total-row.final.credit {
        color: #be123c;
      }

      /* Watermark */
      .watermark {
        position: fixed;
        top: 40%;
        left: 25%;
        transform: rotate(-30deg);
        font-size: 80px;
        color: rgba(190, 18, 60, 0.05);
        font-weight: 800;
        z-index: -1;
        border: 8px solid rgba(190, 18, 60, 0.05);
        padding: 40px;
        border-radius: 20px;
      }

      .qr-code {
        margin-top: 20px;
        text-align: left; /* Align with headers if needed, or keeping styling minimal */
      }
      .qr-img {
        width: 80px;
        height: 80px;
        border: 1px solid #eee;
        padding: 4px;
        background: white;
      }
      
      .system-footer {
        text-align: center;
        margin-top: 40px;
        padding-top: 10px;
        border-top: 1px solid #e2e8f0;
        font-size: 8px;
        color: #cbd5e1;
      }
    </style>
  </head>
  <body>

    {{#if (eq invoiceType 'CREDIT_NOTE')}}
      <div class="watermark">مرتجع / RETURN</div>
    {{/if}}

    {{#if printHeaderFooter}}
    <!-- Header -->
    <div class='header'>
      <div class="hospital-info">
        <h1 class='hospital-name'>{{hospitalName}}</h1>
        <p>{{address}}</p>
        <p dir="ltr">{{phone}} | {{email}}</p>
      </div>
      <div class="invoice-info">
        {{#if (eq invoiceType 'CREDIT_NOTE')}}
          <div class='doc-title credit-note'>إشعار دائن <span style="font-size:12px; color:#94a3b8; font-weight:400;">(Credit Note)</span></div>
        {{else}}
          <div class='doc-title'>فاتورة ضريبية <span style="font-size:12px; color:#94a3b8; font-weight:400;">(Tax Invoice)</span></div>
        {{/if}}
        <div class='invoice-number-badge'>#{{invoiceId}}</div>
      </div>
    </div>
    {{else}}
    <!-- Spacer for pre-printed paper -->
    <div style="height: 150px;"></div>
    <div class="invoice-info" style="text-align: left; margin-bottom: 20px;">
        <div class='invoice-number-badge'>#{{invoiceId}}</div>
    </div>
    {{/if}}

    <!-- Meta Grid -->
    <div class='meta-box'>
      <div class='meta-item'>
        <span class='meta-label'>المريض (Patient)</span>
        <span class='meta-value'>{{patientName}}</span>
        <div style="font-size: 9px; color: #64748b; margin-top:1px;">MRN: {{mrn}}</div>
      </div>
      
      <div class='meta-item'>
        <span class='meta-label'>التاريخ (Date)</span>
        <span class='meta-value'>{{formatDate invoiceDate}}</span>
      </div>

      <div class='meta-item'>
        <span class='meta-label'>العميل/الضامن (Client)</span>
        <span class='meta-value'>{{insuranceProvider}}</span>
      </div>

      <div class='meta-item'>
        <span class='meta-label'>الحالة (Status)</span>
        <span class='meta-value' style="{{#if (eq status 'PAID')}}color:#15803d;{{else}}color:#b45309;{{/if}}">
          {{status}}
        </span>
      </div>
    </div>

    <!-- Items Table -->
    <table>
      <thead>
        <tr>
          <th width='5%'>#</th>
          <th width='50%'>الخدمة (Description)</th>
          <th width='10%' style="text-align: center;">الكمية</th>
          <th width='15%'>سعر الوحدة</th>
          <th width='20%'>الإجمالي</th>
        </tr>
      </thead>
      <tbody>
        {{#each items}}
          <tr>
            <td class="row-num">{{inc @index}}</td>
            <td>
              <div style='font-weight: 700;'>{{serviceName}}</div>
            </td>
            <td style="text-align: center;">{{quantity}}</td>
            <td>{{formatMoney unitPrice}}</td>
            <td>{{formatMoney totalAmount}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>

    <!-- Footer & Totals -->
    <div class='footer-section'>
      <div class="notes-box">
        <strong>ملاحظات / Notes:</strong><br>
        تم إصدار هذه الفاتورة إلكترونياً ولا تحتاج إلى توقيع.<br>
        يرجى الاحتفاظ بهذا المستند للمراجعة.
        {{#if (eq invoiceType 'CREDIT_NOTE')}}
        <br><span style="color: #be123c;">* هذا المستند يمثل استرداداً للمبلغ.</span>
        {{/if}}
        
        <div class='qr-code'>
          {{#if qrCode}}
            <img src='{{qrCode}}' class='qr-img' />
          {{/if}}
        </div>
      </div>

      <div class='totals-box'>
        <div class='total-row'>
          <span>المجموع (Subtotal)</span>
          <span>{{formatMoney subTotal}}</span>
        </div>
        
        {{#if (gt discountAmount 0)}}
        <div class='total-row' style="color: #be123c;">
          <span>الخصم (Discount)</span>
          <span>- {{formatMoney discountAmount}}</span>
        </div>
        {{/if}}

        {{#if (gt vatAmount 0)}}
        <div class='total-row'>
          <span>الضريبة (VAT)</span>
          <span>{{formatMoney vatAmount}}</span>
        </div>
        {{/if}}

        <div class="total-row {{#if (eq invoiceType 'CREDIT_NOTE')}}final credit{{else}}final{{/if}}">
          <span>الإجمالي (Total)</span>
          <span><span style="font-size:10px; font-weight:normal;">LYD</span> {{formatMoney netAmount}}</span>
        </div>
      </div>
    </div>
    
    <div class="system-footer">
       Saraya ERP Systems &copy; 2026
    </div>

  </body>
</html> --}}